name: Build & Push Image

on:
  push:
    branches:
      - dev
jobs:
  build-api-image-push-to-acr:
    uses: ./.github/workflows/build-dev-image.yml
    secrets:
      DEV_ACR_SP_ID: ${{ secrets.DEV_ACR_SP_ID }}
      DEV_ACR_SP_PASSWORD: ${{ secrets.DEV_ACR_SP_PASSWORD }}
  deploy-infra-with-terraform:
    needs: [build-api-image-push-to-acr]
    uses: ./.github/workflows/terraform-apply.yml
  deploy-app-in-k8s:
    needs: [deploy-infra-with-terraform]
    uses: ./.github/workflows/k8s-deploy.yml